{"version":3,"sources":["file:///C:/Users/amali/documents/hugo-site/personal-web/themes/hugo-narrow/assets/js/toc.js"],"sourcesContent":["/**\r\n * 目录功能模块\r\n *\r\n * 使用 Hugo 自带的 TableOfContents 和 Gumshoe 库实现目录高亮\r\n * 支持三种模式：card（卡片）、left（左侧边栏）、right（右侧边栏）\r\n *\r\n */\r\n\r\nclass TOCManager {\r\n  constructor() {\r\n    this.elements = {};\r\n    this.gumshoe = null;\r\n    this.gumshoeCard = null;\r\n    this.gumshoeSidebar = null;\r\n    this.isVisible = false;\r\n    this.mode = this.detectMode();\r\n\r\n    this.init();\r\n  }\r\n\r\n  // 检测 TOC 模式\r\n  detectMode() {\r\n    const sidebar = document.getElementById(\"toc-sidebar\");\r\n    if (sidebar \u0026\u0026 window.innerWidth \u003e= 1280) {\r\n      return \"sidebar\";\r\n    }\r\n    return \"card\";\r\n  }\r\n\r\n  // 初始化\r\n  init() {\r\n    this.cacheElements();\r\n\r\n    // 根据模式初始化不同的功能\r\n    if (this.mode === \"sidebar\") {\r\n      this.initSidebarMode();\r\n    } else {\r\n      this.initCardMode();\r\n    }\r\n\r\n    this.exposeAPI();\r\n    this.handleResize();\r\n  }\r\n\r\n  // 缓存 DOM 元素\r\n  cacheElements() {\r\n    this.elements = {\r\n      card: document.getElementById(\"toc-card\"),\r\n      overlay: document.getElementById(\"toc-overlay\"),\r\n      closeBtn: document.getElementById(\"toc-close\"),\r\n      content: document.getElementById(\"toc-content\"),\r\n      sidebar: document.getElementById(\"toc-sidebar\"),\r\n      sidebarContent: document.getElementById(\"toc-sidebar-content\"),\r\n    };\r\n  }\r\n\r\n  // 初始化卡片模式\r\n  initCardMode() {\r\n    if (!this.elements.card) return;\r\n\r\n    this.bindEvents();\r\n    this.initGumshoeCard();\r\n  }\r\n\r\n  // 初始化侧边栏模式\r\n  initSidebarMode() {\r\n    if (!this.elements.sidebar) return;\r\n\r\n    this.initGumshoeSidebar();\r\n    this.bindSidebarEvents();\r\n  }\r\n\r\n  // 绑定卡片模式事件\r\n  bindEvents() {\r\n    const { closeBtn, overlay, content } = this.elements;\r\n\r\n    // 关闭事件\r\n    closeBtn?.addEventListener(\"click\", () =\u003e this.hide());\r\n    overlay?.addEventListener(\"click\", () =\u003e this.hide());\r\n\r\n    // ESC 键关闭\r\n    document.addEventListener(\"keydown\", (e) =\u003e {\r\n      if (e.key === \"Escape\" \u0026\u0026 this.isVisible) {\r\n        this.hide();\r\n      }\r\n    });\r\n\r\n    // 目录链接点击 - 使用事件委托\r\n    content?.addEventListener(\"click\", (e) =\u003e {\r\n      const link = e.target.closest('a[href^=\"#\"]');\r\n      if (!link) return;\r\n\r\n      e.preventDefault();\r\n      this.scrollToTarget(link.hash);\r\n    });\r\n  }\r\n\r\n  // 绑定侧边栏模式事件\r\n  bindSidebarEvents() {\r\n    const { sidebarContent } = this.elements;\r\n\r\n    // 目录链接点击 - 使用事件委托\r\n    sidebarContent?.addEventListener(\"click\", (e) =\u003e {\r\n      const link = e.target.closest('a[href^=\"#\"]');\r\n      if (!link) return;\r\n\r\n      e.preventDefault();\r\n      this.scrollToTargetSidebar(link.hash);\r\n    });\r\n  }\r\n\r\n  // 滚动到目标位置（卡片模式）\r\n  scrollToTarget(hash) {\r\n    const targetId = this.decodeHash(hash);\r\n    const target = document.getElementById(targetId);\r\n\r\n    if (target) {\r\n      target.scrollIntoView({\r\n        behavior: \"smooth\",\r\n        block: \"start\",\r\n      });\r\n\r\n      // 延迟关闭目录\r\n      setTimeout(() =\u003e this.hide(), 300);\r\n    }\r\n  }\r\n\r\n  // 滚动到目标位置（侧边栏模式）\r\n  scrollToTargetSidebar(hash) {\r\n    const targetId = this.decodeHash(hash);\r\n    const target = document.getElementById(targetId);\r\n\r\n    if (target) {\r\n      target.scrollIntoView({\r\n        behavior: \"smooth\",\r\n        block: \"start\",\r\n      });\r\n    }\r\n  }\r\n\r\n  // 解码 hash\r\n  decodeHash(hash) {\r\n    try {\r\n      return decodeURIComponent(hash.substring(1));\r\n    } catch (e) {\r\n      console.warn(\"Hash 解码失败:\", hash);\r\n      return hash.substring(1);\r\n    }\r\n  }\r\n\r\n  // 初始化 Gumshoe（卡片模式）\r\n  initGumshoeCard() {\r\n    if (typeof Gumshoe === \"undefined\") {\r\n      console.warn(\"Gumshoe 库未加载\");\r\n      return;\r\n    }\r\n\r\n    const tocLinks = document.querySelectorAll(\"#toc-content a\");\r\n    if (tocLinks.length === 0) return;\r\n\r\n    this.gumshoeCard = new Gumshoe(\"#toc-content a\", {\r\n      offset: () =\u003e window.innerHeight * 0.2,\r\n      reflow: true,\r\n      nested: true,\r\n      nestedClass: \"active-parent\",\r\n      navClass: \"active\",\r\n      contentClass: \"active\",\r\n      events: true,\r\n    });\r\n  }\r\n\r\n  // 初始化 Gumshoe（侧边栏模式）\r\n  initGumshoeSidebar() {\r\n    if (typeof Gumshoe === \"undefined\") {\r\n      console.warn(\"Gumshoe 库未加载\");\r\n      return;\r\n    }\r\n\r\n    const tocLinks = document.querySelectorAll(\"#toc-sidebar-content a\");\r\n    if (tocLinks.length === 0) return;\r\n\r\n    this.gumshoeSidebar = new Gumshoe(\"#toc-sidebar-content a\", {\r\n      offset: () =\u003e window.innerHeight * 0.2,\r\n      reflow: true,\r\n      nested: true,\r\n      nestedClass: \"active-parent\",\r\n      navClass: \"active\",\r\n      contentClass: \"active\",\r\n      events: true,\r\n    });\r\n  }\r\n\r\n  // 显示目录\r\n  show() {\r\n    if (!this.elements.card || this.isVisible) return;\r\n\r\n    this.isVisible = true;\r\n    this.toggleElements(true);\r\n    document.body.style.overflow = \"hidden\";\r\n  }\r\n\r\n  // 隐藏目录\r\n  hide() {\r\n    if (!this.elements.card || !this.isVisible) return;\r\n\r\n    this.isVisible = false;\r\n    this.toggleElements(false);\r\n    document.body.style.overflow = \"\";\r\n  }\r\n\r\n  // 切换目录显示\r\n  toggle() {\r\n    this.isVisible ? this.hide() : this.show();\r\n  }\r\n\r\n  // 切换元素显示状态\r\n  toggleElements(show) {\r\n    const { card, overlay } = this.elements;\r\n\r\n    if (show) {\r\n      overlay.classList.remove(\"opacity-0\", \"pointer-events-none\");\r\n      overlay.classList.add(\"opacity-100\");\r\n\r\n      card.classList.remove(\"opacity-0\", \"scale-95\", \"pointer-events-none\");\r\n      card.classList.add(\"opacity-100\", \"scale-100\");\r\n    } else {\r\n      overlay.classList.add(\"opacity-0\", \"pointer-events-none\");\r\n      overlay.classList.remove(\"opacity-100\");\r\n\r\n      card.classList.add(\"opacity-0\", \"scale-95\", \"pointer-events-none\");\r\n      card.classList.remove(\"opacity-100\", \"scale-100\");\r\n    }\r\n  }\r\n\r\n  // 处理窗口大小变化\r\n  handleResize() {\r\n    let resizeTimer;\r\n    window.addEventListener(\"resize\", () =\u003e {\r\n      clearTimeout(resizeTimer);\r\n      resizeTimer = setTimeout(() =\u003e {\r\n        const newMode = this.detectMode();\r\n        if (newMode !== this.mode) {\r\n          // 模式切换，重新初始化\r\n          this.cleanup();\r\n          this.mode = newMode;\r\n          this.cacheElements();\r\n          if (this.mode === \"sidebar\") {\r\n            this.initSidebarMode();\r\n          } else {\r\n            this.initCardMode();\r\n          }\r\n        }\r\n      }, 200);\r\n    });\r\n  }\r\n\r\n  // 暴露 API\r\n  exposeAPI() {\r\n    window.TOC = {\r\n      show: () =\u003e this.show(),\r\n      hide: () =\u003e this.hide(),\r\n      toggle: () =\u003e this.toggle(),\r\n      isVisible: () =\u003e this.isVisible,\r\n      mode: () =\u003e this.mode,\r\n      initialized: true,\r\n    };\r\n  }\r\n\r\n  // 清理资源\r\n  cleanup() {\r\n    this.gumshoeCard?.destroy();\r\n    this.gumshoeSidebar?.destroy();\r\n    this.gumshoeCard = null;\r\n    this.gumshoeSidebar = null;\r\n  }\r\n\r\n  // 销毁\r\n  destroy() {\r\n    this.cleanup();\r\n    document.body.style.overflow = \"\";\r\n  }\r\n}\r\n\r\n// 初始化管理器\r\nlet tocManagerInstance = null;\r\n\r\nfunction initTOC() {\r\n  if (document.readyState === \"loading\") {\r\n    document.addEventListener(\"DOMContentLoaded\", () =\u003e {\r\n      tocManagerInstance = new TOCManager();\r\n    });\r\n  } else {\r\n    // 小延迟确保 DOM 完全渲染\r\n    setTimeout(() =\u003e {\r\n      tocManagerInstance = new TOCManager();\r\n    }, 50);\r\n  }\r\n}\r\n\r\n// 页面卸载时清理\r\nwindow.addEventListener(\"beforeunload\", () =\u003e {\r\n  tocManagerInstance?.destroy();\r\n});\r\n\r\n// 立即初始化\r\ninitTOC();\r\n"],"mappings":"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","names":[]}