(()=>{var n=class{constructor(){this.elements={},this.gumshoe=null,this.gumshoeCard=null,this.gumshoeSidebar=null,this.isVisible=!1,this.mode=this.detectMode(),this.init()}detectMode(){return document.getElementById("toc-sidebar")&&window.innerWidth>=1280?"sidebar":"card"}init(){this.cacheElements(),this.mode==="sidebar"?this.initSidebarMode():this.initCardMode(),this.exposeAPI(),this.handleResize()}cacheElements(){this.elements={card:document.getElementById("toc-card"),overlay:document.getElementById("toc-overlay"),closeBtn:document.getElementById("toc-close"),content:document.getElementById("toc-content"),sidebar:document.getElementById("toc-sidebar"),sidebarContent:document.getElementById("toc-sidebar-content")}}initCardMode(){this.elements.card&&(this.bindEvents(),this.initGumshoeCard())}initSidebarMode(){this.elements.sidebar&&(this.initGumshoeSidebar(),this.bindSidebarEvents())}bindEvents(){let{closeBtn:e,overlay:t,content:s}=this.elements;e?.addEventListener("click",()=>this.hide()),t?.addEventListener("click",()=>this.hide()),document.addEventListener("keydown",i=>{i.key==="Escape"&&this.isVisible&&this.hide()}),s?.addEventListener("click",i=>{let d=i.target.closest('a[href^="#"]');d&&(i.preventDefault(),this.scrollToTarget(d.hash))})}bindSidebarEvents(){let{sidebarContent:e}=this.elements;e?.addEventListener("click",t=>{let s=t.target.closest('a[href^="#"]');s&&(t.preventDefault(),this.scrollToTargetSidebar(s.hash))})}scrollToTarget(e){let t=this.decodeHash(e),s=document.getElementById(t);s&&(s.scrollIntoView({behavior:"smooth",block:"start"}),setTimeout(()=>this.hide(),300))}scrollToTargetSidebar(e){let t=this.decodeHash(e),s=document.getElementById(t);s&&s.scrollIntoView({behavior:"smooth",block:"start"})}decodeHash(e){try{return decodeURIComponent(e.substring(1))}catch{return console.warn("Hash \u89E3\u7801\u5931\u8D25:",e),e.substring(1)}}initGumshoeCard(){if(typeof Gumshoe>"u"){console.warn("Gumshoe \u5E93\u672A\u52A0\u8F7D");return}document.querySelectorAll("#toc-content a").length!==0&&(this.gumshoeCard=new Gumshoe("#toc-content a",{offset:()=>window.innerHeight*.2,reflow:!0,nested:!0,nestedClass:"active-parent",navClass:"active",contentClass:"active",events:!0}))}initGumshoeSidebar(){if(typeof Gumshoe>"u"){console.warn("Gumshoe \u5E93\u672A\u52A0\u8F7D");return}document.querySelectorAll("#toc-sidebar-content a").length!==0&&(this.gumshoeSidebar=new Gumshoe("#toc-sidebar-content a",{offset:()=>window.innerHeight*.2,reflow:!0,nested:!0,nestedClass:"active-parent",navClass:"active",contentClass:"active",events:!0}))}show(){!this.elements.card||this.isVisible||(this.isVisible=!0,this.toggleElements(!0),document.body.style.overflow="hidden")}hide(){!this.elements.card||!this.isVisible||(this.isVisible=!1,this.toggleElements(!1),document.body.style.overflow="")}toggle(){this.isVisible?this.hide():this.show()}toggleElements(e){let{card:t,overlay:s}=this.elements;e?(s.classList.remove("opacity-0","pointer-events-none"),s.classList.add("opacity-100"),t.classList.remove("opacity-0","scale-95","pointer-events-none"),t.classList.add("opacity-100","scale-100")):(s.classList.add("opacity-0","pointer-events-none"),s.classList.remove("opacity-100"),t.classList.add("opacity-0","scale-95","pointer-events-none"),t.classList.remove("opacity-100","scale-100"))}handleResize(){let e;window.addEventListener("resize",()=>{clearTimeout(e),e=setTimeout(()=>{let t=this.detectMode();t!==this.mode&&(this.cleanup(),this.mode=t,this.cacheElements(),this.mode==="sidebar"?this.initSidebarMode():this.initCardMode())},200)})}exposeAPI(){window.TOC={show:()=>this.show(),hide:()=>this.hide(),toggle:()=>this.toggle(),isVisible:()=>this.isVisible,mode:()=>this.mode,initialized:!0}}cleanup(){this.gumshoeCard?.destroy(),this.gumshoeSidebar?.destroy(),this.gumshoeCard=null,this.gumshoeSidebar=null}destroy(){this.cleanup(),document.body.style.overflow=""}},o=null;function r(){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{o=new n}):setTimeout(()=>{o=new n},50)}window.addEventListener("beforeunload",()=>{o?.destroy()});r();})();
